name: Quick Start Validation

on:
  push:
    branches: [main]
    paths:
      - 'index.html'
      - '.github/workflows/quickstart-validation.yml'
  pull_request:
    branches: [main]
    paths:
      - 'index.html'
      - '.github/workflows/quickstart-validation.yml'
  schedule:
    # Run daily at 06:00 UTC (offset from health-check at 00:00)
    - cron: '0 6 * * *'
  workflow_dispatch:
    # Allow manual triggering

jobs:
  validate-quickstart:
    name: Quick Start Examples
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install tsuku
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          bash install.sh --no-modify-path --no-telemetry
          source "$HOME/.tsuku/env"
          echo "$HOME/.tsuku/bin" >> $GITHUB_PATH
          echo "$HOME/.tsuku/tools/current" >> $GITHUB_PATH

      - name: Verify tsuku installed
        run: tsuku --version

      # Test installing a single tool
      # Using k9s as it exists in the registry and is a quick install
      - name: "Test: tsuku install k9s"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "Running: tsuku install k9s"
          tsuku install k9s
          echo "Validation passed"

      # Test installing multiple tools at once
      # Using tools that exist in the registry: terraform, k6, jq
      - name: "Test: tsuku install terraform k6 jq"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "Running: tsuku install terraform k6 jq"
          tsuku install terraform k6 jq
          echo "Validation passed"

      - name: "Test: tsuku list"
        run: |
          echo "Running: tsuku list"
          tsuku list
          echo "Validation passed"

      - name: "Test: Installed tools are executable"
        run: |
          echo "Verifying installed tools are executable..."

          k9s version --short
          echo "k9s: OK"

          terraform version | head -1
          echo "terraform: OK"

          k6 version
          echo "k6: OK"

          jq --version
          echo "jq: OK"

          echo "All tools executable"
